@using System.Linq
@model PhotoApp.ViewModels.PhotosIndexViewModel
@{
    ViewData["Title"] = "ODPO s.r.o. – Katalog vzorků plastů";
    string Safe(string s) => string.IsNullOrWhiteSpace(s) ? "-" : s;
    Func<PhotoApp.Models.PhotoRecord, string> ImageSrc = item =>
        !string.IsNullOrWhiteSpace(item.ImagePath) ? Url.Content(item.ImagePath) :
        !string.IsNullOrWhiteSpace(item.PhotoPath) ? Url.Content(item.PhotoPath) : null;
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
}

<style>
:root {
    --brand: #16a34a;
    --brand-dark: #166534;
    --border: #dbe7d9;
    --bg: #f4fbf4;
    --text: #0b1f0b;
    --white: #fff;
    --pad: 16px;
    --gap: 12px;
    --radius: 16px;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
    color: var(--text);
    background: var(--bg);
}

.container { max-width: 1100px; margin: 0 auto; padding: var(--pad); }

/* Header */
    .header-inner {
        display: flex;
        align-items: center;
        justify-content: center; /* zarovnání na střed */
        gap: 20px;
        flex-wrap: wrap;
        padding: 20px 0;
    }

    .brand {
        display: flex;
        flex-direction: column; /* logo nad nadpis */
        align-items: center; /* centrování obsahu */
        gap: 8px;
        text-decoration: none;
        color: inherit;
    }

        .brand img {
            height: 60px;
            width: auto;
        }

        .brand h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            color: var(--brand-dark);
        }


.header-actions {
    display: flex;
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
    width: 100%;
    margin-top: 12px;
}

.action-btn, .action-pill {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 14px 22px; /* větší tlačítka */
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--white);
    color: inherit;
    text-decoration: none;
    font-size: 20px; /* větší text tlačítek */
    cursor: pointer;
    white-space: nowrap;
}

.action-btn.primary { background: var(--brand); color: #fff; border-color: var(--brand-dark); }
.action-btn.destructive { background: #ef4444; color: #fff; border-color: #b91c1c; }

.inline-form { margin: 0; display: inline-block; }

/* Filters */
.toolbar { background: #fff; border: 1px solid var(--border); border-radius: var(--radius); padding: var(--pad); margin-bottom: var(--pad); }
.filter-form { display: flex; flex-direction: column; gap: var(--gap); }
.filter-form input, .filter-form select { width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--border); font-size: 18px; }

/* Cards */
.card-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--gap);
    max-height: calc(100vh - 270px);
    overflow-y: auto;
    padding-bottom: 16px;
}

.item-card {
    background: #fff;
    border-radius: 20px;
    padding: 16px;
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    font-size: 20px;
}

.thumb {
    width: 400px;
    height: 400px;
    object-fit: cover;
    border-radius: 16px;
}

.card-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    text-align: center;
}

.card-info div { line-height: 1.4; }
.card-info strong { font-weight: 600; }

.card-footer {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 12px;
}

.footer { text-align: center; font-size: 16px; padding: 20px 0; color: #3b6b3b; }

@@media (min-width: 768px) {
    .header-actions { width: auto; margin-left: auto; }
    .filter-form { flex-direction: row; flex-wrap: wrap; }
    .filter-form input, .filter-form select { width: auto; }
    .filter-form input[type="search"] { flex: 1; }
}
</style>

<head>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#16a34a">
</head>

<header class="container">
    <div class="header-inner">
        <div class="brand">
            <img src="/logo.png" alt="ODPO logo" />
            <h1>Katalog vzorků</h1>
        </div>

        <div class="header-actions">
            <a href="@Url.Action("Create", "Photos")" class="action-btn primary">+ Nový</a>
            <a href="@Url.Action("GetBackup", "DatabaseBackup")" class="action-btn">Záloha</a>
            <a href="@Url.Action("Database", "Admin")" class="action-btn brand">Obnova</a>
            <a href="@Url.Action("Import", "Photos")" class="action-btn">Import</a>
            @if (User?.Identity?.IsAuthenticated ?? false)
            {
                <form asp-controller="Home" asp-action="ClearPhotos" method="post" class="inline-form"
                      onsubmit="return confirm('Opravdu vymazat všechny fotky?');">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="action-btn destructive">Vymazat vše</button>
                </form>
            }
        </div>
    </div>
</header>

<main class="container">
    <div class="user-actions">
        @if (User?.Identity?.IsAuthenticated ?? false)
        {
            <form asp-controller="Account" asp-action="Logout" method="post" class="inline-form">
                @Html.AntiForgeryToken()
                <button type="submit" class="action-pill" title="Odhlásit se">Odhlásit</button>
            </form>
        }
        else
        {
            <a asp-controller="Account" asp-action="Login" class="action-pill">Přihlásit</a>
        }
    </div>

    <div class="toolbar">
        <form method="get" class="filter-form">
            <input type="search" name="search" placeholder="Hledat…" value="@(Model?.Search ?? "")" />
            <select name="supplier">
                <option value="">Všichni dodavatelé</option>
                @foreach (var s in Model?.Suppliers ?? Enumerable.Empty<string>()) { <option value="@s" selected="@(s == Model?.Supplier)">@s</option> }
            </select>
            <select name="material">
                <option value="">Všechny materiály</option>
                @foreach (var m in Model?.Materials ?? Enumerable.Empty<string>()) { <option value="@m" selected="@(m == Model?.Material)">@m</option> }
            </select>
            <select name="color">
                <option value="">Všechny barvy</option>
                @foreach (var c in Model?.Colors ?? Enumerable.Empty<string>()) { <option value="@c" selected="@(c == Model?.Color)">@c</option> }
            </select>
            <select name="position">
                <option value="">Všechny pozice</option>
                @foreach (var p in Model?.Positions ?? Enumerable.Empty<string>()) { <option value="@p" selected="@(p == Model?.Position)">@p</option> }
            </select>
            <button type="submit" class="action-btn">Filtrovat</button>
            <a href="@Url.Action("Index", "Photos")" class="action-btn">Smazat filtry</a>
        </form>
    </div>

    <div class="card-list">
        @foreach (var item in Model.Items)
        {
            var src = ImageSrc(item);
            <div class="item-card">
                @if (!string.IsNullOrEmpty(src))
                {
                    <a href="@Url.Action("Details", new { id = item.Id })">
                        <img src="@src" alt="@item.Name" class="thumb" />
                    </a>
                }
                <div class="card-info">
                    <div><strong>Materiál:</strong> @Safe(item.Material)</div>
                    <div><strong>Dodavatel:</strong> @Safe(item.Supplier)</div>
                    <div><strong>Barva:</strong> @Safe(item.Color)</div>
                    <div><strong>Pozice:</strong> @Safe(item.Position)</div>
                </div>
                <div class="card-footer">
    <a href="@Url.Action("Edit", new { id = item.Id })" class="action-btn">Upravit</a>
    <a href="@Url.Action("Details", new { id = item.Id })" class="action-btn primary">Detail</a>
    <a href="@Url.Action("Delete", new { id = item.Id })" class="action-btn destructive"
       onclick="return confirm('Opravdu chcete tento vzorek smazat?');">Smazat</a>
</div>
            </div>
        }
    </div>

    <div class="footer">Data se ukládají v databázi. Pro zálohu exportujte data ze serveru.</div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }
    </script>


</main>
